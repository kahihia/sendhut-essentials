{% load static %}
<script src="{% static 'vendor/jquery.js' %}"></script>
<script src="{% static 'vendor/clipboard.min.js' %}"></script>
<script src="{% static 'vendor/popper.js' %}"></script>
<script src="{% static 'vendor/bootstrap.js' %}"></script>
<script src="{% static 'vendor/scrollPosStyler.js' %}"></script>
<script src="{% static 'vendor/holder.js' %}"></script>
<script src="{% static 'vendor/js.cookie.js' %}"></script>
<script src="{% static 'vendor/jquery.serialize-object.min.js' %}"></script>
<script src="{% static 'vendor/slidepanel/slidepanel.js' %}"></script>
<link rel="stylesheet" href="{% static 'vendor/slidepanel/slidepanel.css' %}">

<script src="{% static 'js/app.js' %}"></script>

<script type="text/javascript">
$(function () {


    new Clipboard('.copy');

    $('body').tooltip({
        selector: '[data-toggle="tooltip"]'
    });

    // item detail modal
    $('body').on('click', '.item-popup', function() {
        var dataURL = $(this).attr('data-href');
        $('.food-modal').load(dataURL, function(){
            $('#item-modal').modal({show: true});
        });
    });

    // side rail cart
    $('[data-slidepanel]').slidepanel({
        orientation: 'right',
        mode: 'overlay'
    });

    // item quantity spinner
    $('#item-modal').on('click', '.number-spinner button', function(e){
        e.preventDefault();
        var btn = $(this),
            oldValue = btn.closest('.number-spinner').find('input').val().trim(),
            newVal = 0;

        if (btn.attr('data-dir') == 'up') {
            newVal = parseInt(oldValue) + 1;
        } else {
            if (oldValue > 1) {
                newVal = parseInt(oldValue) - 1;
            } else {
                newVal = 1;
            }
        }

        btn.closest('.number-spinner').find('input').val(newVal);
    });
  })

</script>
<script type="text/javascript">
/*! Tiny Pub/Sub - v0.7.0 - 2013-01-29
* https://github.com/cowboy/jquery-tiny-pubsub
* Copyright (c) 2013 "Cowboy" Ben Alman; Licensed MIT */
(function($) {

  var o = $({});

  $.subscribe = function() {
    o.on.apply(o, arguments);
  };

  $.unsubscribe = function() {
    o.off.apply(o, arguments);
  };

  $.publish = function() {
    o.trigger.apply(o, arguments);
  };

}(jQuery));
var csrftoken = Cookies.get('csrftoken');

function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}

$.ajaxSetup({beforeSend: function(xhr, settings) {
    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
        xhr.setRequestHeader("X-CSRFToken", csrftoken);
    }
  }});



// add to cart
$('body').on('click', '#item-modal #add-to-cart', function(e) {
    e.preventDefault();
    var item = ($('#item-form').serializeObject())
    $.ajax({
      type: "POST",
      url: '/lunch/cart/',
      dataType: 'json',
      contentType: 'application/json',
      data: JSON.stringify(item),
      success: function(data, status) {
        var href = $('[data-slidepanel]').data('href');
        $('#slidepanel').html('').load(href, function() {});
        console.log(status);
        var x = $('#cart-item-count').html();
        $('#cart-item-count').html(parseInt(x) + 1);
      }
    });
});

// delete from cart

$('body').on('click', '.cart-line .delete', function(e) {
      e.preventDefault();
      var url = $(this).data('href');
      $.ajax({
      type: "POST",
      url: url,
      dataType: 'json',
      contentType: 'application/json',
      success: function(data, status) {
        var href = $('[data-slidepanel]').data('href');
        $('#slidepanel').html('').load(href, function() {});
        var x = $('#cart-item-count').html();
        $('#cart-item-count').html(parseInt(x) - 1);
      }
     });
  });


$('body').on('click', '.cart-line .x-delete', function(e) {
      e.preventDefault();
      var url = $(this).data('href');
      $.ajax({
      type: "POST",
      url: url,
      dataType: 'json',
      contentType: 'application/json',
      success: function(data, status) {
      $('#cart-confirm').html('').load('/lunch/cart/reload', function() {});
      var href = $('[data-slidepanel]').data('href');
      $('#slidepanel').html('').load(href, function() {});
      var x = $('#cart-item-count').html();
      $('#cart-item-count').html(parseInt(x) - 1);
      }
      });
  });


$('body').on('click', 'li.page-item', function() {
  $('li.page-item').removeClass('active');
  $(this).toggleClass("active");
  var limit = $(this).attr('data-limit');
  console.log(limit);
  if(limit == "alt") {
    $("#other_limit").show();
  } else {
    $("input#limit").val(limit);
  }
});



$('body').on('change', '#other_limit', function() {
  var limit = $(this).val();
  console.log(limit);
  $("input#limit").val(limit);
});

</script>
